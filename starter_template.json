{
  "fileSummary": {
    "generationHeader": "This file is a merged representation of the entire codebase, combined into a single document by Repomix.",
    "purpose": "This file contains a packed representation of the entire repository's contents.\nIt is designed to be easily consumable by AI systems for analysis, code review,\nor other automated processes.",
    "fileFormat": "The content is organized as follows:\n1. This summary section\n2. Repository information\n3. Directory structure\n4. Repository files, each consisting of:\n   - File path as a key\n   - Full contents of the file as the value",
    "usageGuidelines": "- This file should be treated as read-only. Any changes should be made to the\n  original repository files, not this packed version.\n- When processing this file, use the file path to distinguish\n  between different files in the repository.\n- Be aware that this file may contain sensitive information. Handle it with\n  the same level of security as you would the original repository.",
    "notes": "- Some files may have been excluded based on .gitignore rules and Repomix's configuration\n- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files\n- Files matching patterns in .gitignore are excluded\n- Files matching default ignore patterns are excluded\n- Files are sorted by Git change count (files with more changes are at the bottom)"
  },
  "directoryStructure": ".github/\n  ISSUE_TEMPLATE/\n    bug-report.md\n    documentation-improvement.md\n    feature-request.md\n  PULL_REQUEST_TEMPLATE/\n    PULL_REQUEST_TEMPLATE.md\n  workflows/\n    checkmarx.yaml\n    ci.yaml\n  dependabot.yml\ncontract/\n  .vscode/\n    launch.json\n    tasks.json\n  src/\n    test/\n      counter-simulator.ts\n      counter.test.ts\n    counter.compact\n    index.ts\n    witnesses.ts\n  .prettierrc\n  eslint.config.mjs\n  package.json\n  tsconfig.build.json\n  tsconfig.json\n  vitest.config.ts\ncounter-cli/\n  src/\n    test/\n      commons.ts\n      counter.api.test.ts\n    api.ts\n    cli.ts\n    common-types.ts\n    config.ts\n    index.ts\n    logger-utils.ts\n    standalone.ts\n    testnet-local.ts\n    testnet-remote-start-proof-server.ts\n    testnet-remote.ts\n  .prettierrc.json\n  eslint.config.mjs\n  package.json\n  proof-server-devnet.yml\n  proof-server-testnet.yml\n  proof-server.yml\n  standalone-latest.yml\n  standalone.yml\n  tsconfig.build.json\n  tsconfig.json\n  vitest.config.ts\n  vitest.setup.ts\n.gitignore\n.repomixignore\npackage.json\nREADME.md\nrepomix.config.json\nTESTING.md",
  "files": {
    ".repomixignore": "# Add patterns to ignore here, one per line\n# Example:\n# *.log\n# tmp/",
    "repomix.config.json": "{\n  \"$schema\": \"https://repomix.com/schemas/latest/schema.json\",\n  \"input\": {\n    \"maxFileSize\": 52428800\n  },\n  \"output\": {\n    \"filePath\": \"starter_template.json\",\n    \"style\": \"json\",\n    \"parsableStyle\": false,\n    \"fileSummary\": true,\n    \"directoryStructure\": true,\n    \"files\": true,\n    \"removeComments\": false,\n    \"removeEmptyLines\": false,\n    \"compress\": false,\n    \"topFilesLength\": 5,\n    \"showLineNumbers\": false,\n    \"truncateBase64\": false,\n    \"copyToClipboard\": false,\n    \"includeFullDirectoryStructure\": false,\n    \"tokenCountTree\": false,\n    \"git\": {\n      \"sortByChanges\": true,\n      \"sortByChangesMaxCommits\": 100,\n      \"includeDiffs\": false,\n      \"includeLogs\": false,\n      \"includeLogsCount\": 50\n    }\n  },\n  \"include\": [],\n  \"ignore\": {\n    \"useGitignore\": true,\n    \"useDotIgnore\": true,\n    \"useDefaultPatterns\": true,\n    \"customPatterns\": []\n  },\n  \"security\": {\n    \"enableSecurityCheck\": true\n  },\n  \"tokenCount\": {\n    \"encoding\": \"o200k_base\"\n  }\n}",
    ".github/ISSUE_TEMPLATE/bug-report.md": "---\nname: Bug Report\nabout: Describe this issue template's purpose here.\ntitle: \"\"\nlabels: example-counter, public\nassignees: \"\"\n---\n\nBug Report: Provide detailed information about the issue, including steps to reproduce it, expected behavior, and actual behaviour, screenshots or any other relevant information\n\n#### Describe what the problem is\n\n#### What should be the expected behavior or results?\n\n#### What was the actual behavior or results?\n\n#### Provide any other clarifying details that would help in reproducing or identifying the issue",
    ".github/ISSUE_TEMPLATE/documentation-improvement.md": "---\nname: Documentation Improvement\nabout: Describe this issue template's purpose here.\ntitle: \"\"\nlabels: example-counter, public\nassignees: \"\"\n---\n\nDocumentation Improvement: Clearly describe the improvement requested for existing content and/or raise missing areas of documentation and provide details for what should be included.\n\n#### Documentation url: Specify the exact location of the documentation you are referencing.\n\n#### Description of Improvement: Provide a detailed description of the requested improvement.\n\n#### Proposed Solution (Optional):\n\nIf you have specific suggestions for how to implement the improvement, provide them here.\nThis could include suggested wording, code snippets, or structural changes",
    ".github/ISSUE_TEMPLATE/feature-request.md": "---\nname: Feature Request\nabout: Describe this issue template's purpose here.\ntitle: \"\"\nlabels: example-counter, public\nassignees: \"\"\n---\n\nFeature Request: Clearly describe your feature, its benefits, and most important the expected outcome. This helps us analyze the proposed solution and develop alternatives\n\n#### Describe the proposed feature.\n\n#### User Need: What user need does this feature address? Include use cases and user stories.\n\n#### Benefit: What benefits does this feature provide to users and the platform?\n\n#### Details: Proposed implementation ideas, alternatives considered, dependencies, and any additional information.",
    ".github/PULL_REQUEST_TEMPLATE/PULL_REQUEST_TEMPLATE.md": "## Overview\n\n<!-- Describe your changes briefly here, with some context as to why this is needed. -->\n\n## Submission Checklist\n\n<!-- Please check all the boxes that apply to your pull request. -->\n\n- [ ] Useful pull request description\n- [ ] Tests are provided (if possible)\n- [ ] Key commits have useful messages\n- [ ] All check jobs of the CI have succeeded\n- [ ] Self-reviewed the diff\n- [ ] Reviewer requested\n- [ ] Update README file (if relevant)\n- [ ] Update documentation (if relevant)\n- [ ] No new TODOs introduced\n\n## Links\n\n<!--\n- Link any relevant Confluence or additional Jira tickets if need be\n- If your PR closes some of the existing issues, please add links to them here.\n  Mentioned issues will be automatically closed.\n  Usage: \"Closes #<issue number>\", or \"Closes (paste link of issue)\"\n-->",
    ".github/workflows/checkmarx.yaml": "name: Checkmarx One Scan\n\n# ↓ lock down top‐level permissions. Define all permissions at job level\npermissions: {}\n\non:\n  pull_request_target:  # Changed from pull_request to pull_request_target\n    types: [opened, synchronize, reopened]\n    branches: [ '**' ]\n  push:\n    branches: [ 'main' ]\n  workflow_dispatch: {}   # so you can still run it manually\n  schedule:\n    - cron: \"0 0 * * *\"   # run daily at midnight UTC\nconcurrency:\n  group: ${{ github.workflow }}-${{ github.head_ref }}\n  cancel-in-progress: true\njobs:\n  build:\n    permissions:\n      contents: read             # we only need to checkout code\n      actions: read              # to query workflows/runs\n      pull-requests: write       # to comment on or label PRs\n      security-events: write\n\n    runs-on: ubuntu-latest\n\n    steps:\n      # CRITICAL: DO NOT CHECKOUT THE PR CODE\n      # This is what makes it safe with pull_request_target\n\n      - name: Checkmarx Full Scan\n        uses: midnightntwrk/upload-sarif-github-action/checkmarx-scan-public@53cdf3148dbbd85518ecc5e8f1ec485852c99c36\n        with:\n          cx-client-id: ${{ secrets.CX_CLIENT_ID }}\n          cx-client-secret: ${{ secrets.CX_CLIENT_SECRET_EU }}\n          cx-tenant: ${{ secrets.CX_TENANT }}\n          scs-repo-token: ${{ secrets.MIDNIGHTCI_REPO }}\n          upload-to-github: 'true'",
    ".github/workflows/ci.yaml": "name: CI\n\n# ↓ lock down top‐level permissions. Define all permissions at job level\npermissions: {}\n\non:\n  push:\n    branches: [ main ]\n  pull_request:\n    branches: [ main ]\n\njobs:\n  install-and-test:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: read             # we only need to checkout code\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8  #v6.0.1\n\n      - name: Prefer Google mirror globally\n        run: |\n          echo '{\"registry-mirrors\":[\"https://mirror.gcr.io\"]}' | sudo tee /etc/docker/daemon.json\n          sudo systemctl restart docker\n\n      - name: Setup Compact Compiler\n        uses: midnightntwrk/setup-compact-action@4130145456ad3f45934788dd4a65647eb283e658\n        with:\n          compact-version: '0.26.0'\n\n      - name: Install Node.js\n        uses: actions/setup-node@395ad3262231945c25e8478fd5baf05154b1d79f  #v6.1.0\n        with:\n          node-version: '20'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Compile and test contract\n        working-directory: contract\n        run: |\n          npm run lint\n          npm run compact\n          npm run typecheck\n          npm run build\n          npm run test\n\n      - name: Compile counter-cli\n        working-directory: counter-cli\n        run: |\n          npm run lint\n          npm run typecheck\n          npm run build\n          npm run test-api",
    ".github/dependabot.yml": "version: 2\nupdates:\n  - package-ecosystem: \"github-actions\"\n    directory: \"/\"\n    schedule:\n      interval: \"weekly\"\n    labels:\n      - 'dependencies'\n      - 'github-actions'\n\n  - package-ecosystem: \"npm\"\n    directory: \"/\"\n    schedule:\n      interval: \"daily\"\n    open-pull-requests-limit: 30\n    labels:\n      - 'dependencies'\n      - 'npm'\n    versioning-strategy: auto\n      \n  - package-ecosystem: \"npm\"\n    directory: \"/contract\"\n    schedule:\n      interval: \"daily\"\n    labels:\n      - 'dependencies'\n      - 'npm'\n      - 'contract'\n\n  - package-ecosystem: \"npm\"\n    directory: \"/counter-cli\"\n    schedule:\n      interval: \"daily\"\n    labels:\n      - 'dependencies'\n      - 'npm'\n      - 'counter-cli'",
    "contract/.vscode/launch.json": "{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n      {\n        \"type\": \"node\",\n        \"request\": \"launch\",\n        \"name\": \"Launch Compact debug\",\n        \"program\": \"${file}\",\n        \"skipFiles\": [\n          \"<node_internals>/**\"\n        ],\n        \"outFiles\": [\n          \"${workspaceFolder}/**/*.js\",\n          \"${workspaceFolder}/**/*.cjs\"\n        ]\n      }\n    ]\n  }",
    "contract/.vscode/tasks.json": "{\n  \"version\": \"2.0.0\",\n  \"tasks\": [\n    {\n      \"label\": \"Compile compact file to JS\",\n      \"type\": \"shell\",\n      \"command\": \"npx run-compactc --skip-zk ${file} ${workspaceFolder}/src/managed\",\n      \"group\": \"build\",\n      \"presentation\": {\n        \"echo\": true,\n        \"reveal\": \"never\",\n        \"focus\": false,\n        \"panel\": \"shared\",\n        \"showReuseMessage\": false,\n        \"clear\": true,\n        \"revealProblems\": \"onProblem\"\n      },\n      \"problemMatcher\": [\n        \"$compactException\",\n        \"$compactInternal\",\n        \"$compactCommandNotFound\"\n      ]\n    }\n  ]\n}",
    "contract/src/test/counter-simulator.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {\n  type CircuitContext,\n  QueryContext,\n  sampleContractAddress,\n  constructorContext\n} from \"@midnight-ntwrk/compact-runtime\";\nimport {\n  Contract,\n  type Ledger,\n  ledger\n} from \"../managed/counter/contract/index.cjs\";\nimport { type CounterPrivateState, witnesses } from \"../witnesses.js\";\n\n// This is over-kill for such a simple contract, but the same pattern can be used to test more\n// complex contracts.\nexport class CounterSimulator {\n  readonly contract: Contract<CounterPrivateState>;\n  circuitContext: CircuitContext<CounterPrivateState>;\n\n  constructor() {\n    this.contract = new Contract<CounterPrivateState>(witnesses);\n    const {\n      currentPrivateState,\n      currentContractState,\n      currentZswapLocalState\n    } = this.contract.initialState(\n      constructorContext({ privateCounter: 0 }, \"0\".repeat(64))\n    );\n    this.circuitContext = {\n      currentPrivateState,\n      currentZswapLocalState,\n      originalState: currentContractState,\n      transactionContext: new QueryContext(\n        currentContractState.data,\n        sampleContractAddress()\n      )\n    };\n  }\n\n  public getLedger(): Ledger {\n    return ledger(this.circuitContext.transactionContext.state);\n  }\n\n  public getPrivateState(): CounterPrivateState {\n    return this.circuitContext.currentPrivateState;\n  }\n\n  public increment(): Ledger {\n    // Update the current context to be the result of executing the circuit.\n    this.circuitContext = this.contract.impureCircuits.increment(\n      this.circuitContext\n    ).context;\n    return ledger(this.circuitContext.transactionContext.state);\n  }\n}",
    "contract/src/test/counter.test.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { CounterSimulator } from \"./counter-simulator.js\";\nimport {\n  NetworkId,\n  setNetworkId\n} from \"@midnight-ntwrk/midnight-js-network-id\";\nimport { describe, it, expect } from \"vitest\";\n\nsetNetworkId(NetworkId.Undeployed);\n\ndescribe(\"Counter smart contract\", () => {\n  it(\"generates initial ledger state deterministically\", () => {\n    const simulator0 = new CounterSimulator();\n    const simulator1 = new CounterSimulator();\n    expect(simulator0.getLedger()).toEqual(simulator1.getLedger());\n  });\n\n  it(\"properly initializes ledger state and private state\", () => {\n    const simulator = new CounterSimulator();\n    const initialLedgerState = simulator.getLedger();\n    expect(initialLedgerState.round).toEqual(0n);\n    const initialPrivateState = simulator.getPrivateState();\n    expect(initialPrivateState).toEqual({ privateCounter: 0 });\n  });\n\n  it(\"increments the counter correctly\", () => {\n    const simulator = new CounterSimulator();\n    const nextLedgerState = simulator.increment();\n    expect(nextLedgerState.round).toEqual(1n);\n    const nextPrivateState = simulator.getPrivateState();\n    expect(nextPrivateState).toEqual({ privateCounter: 0 });\n  });\n});",
    "contract/src/counter.compact": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\npragma language_version >= 0.16 && <= 0.18;\n\nimport CompactStandardLibrary;\n\n// public state\nexport ledger round: Counter;\n\n// transition function changing public state\nexport circuit increment(): [] {\n  round.increment(1);\n}",
    "contract/src/index.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nexport * as Counter from \"./managed/counter/contract/index.cjs\";\nexport * from \"./witnesses\";",
    "contract/src/witnesses.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n// This is how we type an empty object.\nexport type CounterPrivateState = {\n  privateCounter: number;\n};\n\nexport const witnesses = {};",
    "contract/.prettierrc": "{ \"trailingComma\": \"none\" }",
    "contract/eslint.config.mjs": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport js from \"@eslint/js\";\nimport plugin from \"@typescript-eslint/eslint-plugin\";\nimport parser from \"@typescript-eslint/parser\";\nimport pluginPrettier from \"eslint-plugin-prettier\";\n\nexport default [\n  js.configs.recommended,\n  {\n    files: [\"**/*.ts\", \"**/*.tsx\"],\n    languageOptions: {\n      parser,\n      parserOptions: {\n        ecmaVersion: \"latest\",\n        sourceType: \"module\",\n        project: [\"./tsconfig.json\"]\n      }\n    },\n    plugins: {\n      \"@typescript-eslint\": plugin,\n      prettier: pluginPrettier\n    },\n    rules: {\n      \"prettier/prettier\": \"error\",\n      \"@typescript-eslint/no-misused-promises\": \"off\",\n      \"@typescript-eslint/no-floating-promises\": \"warn\",\n      \"@typescript-eslint/promise-function-async\": \"off\",\n      \"@typescript-eslint/no-redeclare\": \"off\",\n      \"@typescript-eslint/no-invalid-void-type\": \"off\",\n      \"@typescript-eslint/no-unsafe-call\": \"off\",\n      \"@typescript-eslint/no-unsafe-member-access\": \"off\",\n      \"@typescript-eslint/explicit-function-return-type\": \"off\",\n      \"@typescript-eslint/consistent-type-definitions\": \"off\"\n    }\n  },\n  {\n    ignores: [\"src/managed/**\"]\n  }\n];",
    "contract/package.json": "{\n  \"name\": \"@midnight-ntwrk/counter-contract\",\n  \"version\": \"0.1.0\",\n  \"license\": \"Apache-2.0\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"main\": \"dist/index.js\",\n  \"module\": \"dist/index.js\",\n  \"types\": \"./dist/index.d.ts\",\n  \"exports\": {\n    \".\": {\n      \"types\": \"./dist/index.d.ts\",\n      \"require\": \"./dist/index.js\",\n      \"import\": \"./dist/index.js\",\n      \"default\": \"./dist/index.js\"\n    }\n  },\n  \"scripts\": {\n    \"compact\": \"compact compile src/counter.compact src/managed/counter\",\n    \"test\": \"vitest run\",\n    \"test:compile\": \"npm run compact && vitest run\",\n    \"build\": \"rm -rf dist && tsc --project tsconfig.build.json && cp -Rf ./src/managed ./dist/managed && cp ./src/counter.compact ./dist\",\n    \"lint\": \"eslint src\",\n    \"typecheck\": \"tsc -p tsconfig.json --noEmit\"\n  }\n}",
    "contract/tsconfig.build.json": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n{\n  \"extends\": \"./tsconfig.json\",\n  \"exclude\": [\"src/test/**/*.ts\"],\n  \"compilerOptions\": {}\n}",
    "contract/tsconfig.json": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n{\n  \"include\": [\"src/**/*.ts\"],\n  \"compilerOptions\": {\n    \"rootDir\": \"src\",\n    \"outDir\": \"dist\",\n    \"declaration\": true,\n    \"lib\": [\"ESNext\"],\n    \"target\": \"ES2022\",\n    \"module\": \"ESNext\",\n    \"moduleResolution\": \"node\",\n    \"allowJs\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"noImplicitAny\": true,\n    \"strict\": true,\n    \"isolatedModules\": true,\n    \"sourceMap\": true,\n    \"resolveJsonModule\": true,\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true\n  }\n}",
    "contract/vitest.config.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { defineConfig } from \"vitest/config\";\n\nexport default defineConfig({\n  mode: \"node\",\n  test: {\n    deps: {\n      interopDefault: true\n    },\n    globals: true,\n    environment: \"node\",\n    include: [\"**/*.test.ts\"],\n    exclude: [\"node_modules\"],\n    root: \".\",\n    coverage: {\n      provider: \"v8\",\n      reporter: [\"text\", \"json\", \"html\"],\n      thresholds: {\n        branches: 50,\n        functions: 73,\n        lines: 72,\n        statements: -269\n      }\n    },\n    reporters: [\"default\", [\"junit\", { outputFile: \"reports/report.xml\" }]]\n  },\n  resolve: {\n    extensions: [\".ts\", \".js\"],\n    conditions: [\"import\", \"node\", \"default\"]\n  }\n});",
    "counter-cli/src/test/commons.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { type Config, StandaloneConfig, currentDir, TestnetRemoteConfig } from '../config';\nimport {\n  DockerComposeEnvironment,\n  GenericContainer,\n  type StartedDockerComposeEnvironment,\n  type StartedTestContainer,\n  Wait,\n} from 'testcontainers';\nimport path from 'path';\nimport * as api from '../api';\nimport * as Rx from 'rxjs';\nimport { nativeToken } from '@midnight-ntwrk/ledger';\nimport type { Logger } from 'pino';\nimport type { Wallet } from '@midnight-ntwrk/wallet-api';\nimport type { Resource } from '@midnight-ntwrk/wallet';\nimport { expect } from 'vitest';\n\nconst GENESIS_MINT_WALLET_SEED = '0000000000000000000000000000000000000000000000000000000000000001';\n\nexport interface TestConfiguration {\n  seed: string;\n  entrypoint: string;\n  dappConfig: Config;\n  psMode: string;\n  cacheFileName: string;\n}\n\nexport class LocalTestConfig implements TestConfiguration {\n  seed = GENESIS_MINT_WALLET_SEED;\n  entrypoint = 'dist/standalone.js';\n  psMode = 'undeployed';\n  cacheFileName = '';\n  dappConfig = new StandaloneConfig();\n}\n\nexport function parseArgs(required: string[]): TestConfiguration {\n  let entry = '';\n  if (required.includes('entry')) {\n    if (process.env.TEST_ENTRYPOINT !== undefined) {\n      entry = process.env.TEST_ENTRYPOINT;\n    } else {\n      throw new Error('TEST_ENTRYPOINT environment variable is not defined.');\n    }\n  }\n\n  let seed = '';\n  if (required.includes('seed')) {\n    if (process.env.TEST_WALLET_SEED !== undefined) {\n      seed = process.env.TEST_WALLET_SEED;\n    } else {\n      throw new Error('TEST_WALLET_SEED environment variable is not defined.');\n    }\n  }\n\n  let cfg: Config = new TestnetRemoteConfig();\n  let env = '';\n  let psMode = 'undeployed';\n  let cacheFileName = '';\n  if (required.includes('env')) {\n    if (process.env.TEST_ENV !== undefined) {\n      env = process.env.TEST_ENV;\n    } else {\n      throw new Error('TEST_ENV environment variable is not defined.');\n    }\n    switch (env) {\n      case 'testnet':\n        cfg = new TestnetRemoteConfig();\n        psMode = 'testnet';\n        cacheFileName = `${seed.substring(0, 7)}-${psMode}.state`;\n        break;\n      default:\n        throw new Error(`Unknown env value=${env}`);\n    }\n  }\n\n  return {\n    seed,\n    entrypoint: entry,\n    dappConfig: cfg,\n    psMode,\n    cacheFileName,\n  };\n}\n\nexport class TestEnvironment {\n  private readonly logger: Logger;\n  private env: StartedDockerComposeEnvironment | undefined;\n  private dockerEnv: DockerComposeEnvironment | undefined;\n  private container: StartedTestContainer | undefined;\n  private wallet: (Wallet & Resource) | undefined;\n  private testConfig: TestConfiguration;\n\n  constructor(logger: Logger) {\n    this.logger = logger;\n    this.testConfig = new LocalTestConfig();\n  }\n\n  start = async (): Promise<TestConfiguration> => {\n    if (process.env.RUN_ENV_TESTS === 'true') {\n      this.testConfig = parseArgs(['seed', 'env']);\n      this.logger.info(`Test wallet seed: ${this.testConfig.seed}`);\n      this.logger.info('Proof server starting...');\n      this.container = await TestEnvironment.getProofServerContainer(this.testConfig.psMode);\n      this.testConfig.dappConfig = {\n        ...this.testConfig.dappConfig,\n        proofServer: `http://${this.container.getHost()}:${this.container.getMappedPort(6300).toString()}`,\n      };\n    } else {\n      this.testConfig = new LocalTestConfig();\n      this.logger.info('Test containers starting...');\n      const composeFile = process.env.COMPOSE_FILE ?? 'standalone.yml';\n      this.logger.info(`Using compose file: ${composeFile}`);\n      this.dockerEnv = new DockerComposeEnvironment(path.resolve(currentDir, '..'), composeFile)\n        .withWaitStrategy(\n          'counter-proof-server',\n          Wait.forLogMessage('Actix runtime found; starting in Actix runtime', 1),\n        )\n        .withWaitStrategy('counter-indexer', Wait.forLogMessage(/starting indexing/, 1));\n      this.env = await this.dockerEnv.up();\n\n      this.testConfig.dappConfig = {\n        ...this.testConfig.dappConfig,\n        indexer: TestEnvironment.mapContainerPort(this.env, this.testConfig.dappConfig.indexer, 'counter-indexer'),\n        indexerWS: TestEnvironment.mapContainerPort(this.env, this.testConfig.dappConfig.indexerWS, 'counter-indexer'),\n        node: TestEnvironment.mapContainerPort(this.env, this.testConfig.dappConfig.node, 'counter-node'),\n        proofServer: TestEnvironment.mapContainerPort(\n          this.env,\n          this.testConfig.dappConfig.proofServer,\n          'counter-proof-server',\n        ),\n      };\n    }\n    this.logger.info(`Configuration:${JSON.stringify(this.testConfig)}`);\n    this.logger.info('Test containers started');\n    return this.testConfig;\n  };\n\n  static mapContainerPort = (env: StartedDockerComposeEnvironment, url: string, containerName: string) => {\n    const mappedUrl = new URL(url);\n    const container = env.getContainer(containerName);\n\n    mappedUrl.port = String(container.getFirstMappedPort());\n\n    return mappedUrl.toString().replace(/\\/+$/, '');\n  };\n\n  static getProofServerContainer = async (env: string) =>\n    await new GenericContainer('midnightnetwork/proof-server:4.0.0')\n      .withExposedPorts(6300)\n      .withCommand([`midnight-proof-server --network ${env}`])\n      .withEnvironment({ RUST_BACKTRACE: 'full' })\n      .withWaitStrategy(Wait.forLogMessage('Actix runtime found; starting in Actix runtime', 1))\n      .start();\n\n  shutdown = async () => {\n    if (this.wallet !== undefined) {\n      await this.wallet.close();\n    }\n    if (this.env !== undefined) {\n      this.logger.info('Test containers closing');\n      await this.env.down();\n    }\n    if (this.container !== undefined) {\n      this.logger.info('Test container closing');\n      await this.container.stop();\n    }\n  };\n\n  getWallet = async () => {\n    this.logger.info('Setting up wallet');\n    this.wallet = await api.buildWalletAndWaitForFunds(\n      this.testConfig.dappConfig,\n      this.testConfig.seed,\n      this.testConfig.cacheFileName,\n    );\n    expect(this.wallet).not.toBeNull();\n    const state = await Rx.firstValueFrom(this.wallet.state());\n    expect(state.balances[nativeToken()].valueOf()).toBeGreaterThan(BigInt(0));\n    return this.wallet;\n  };\n\n  saveWalletCache = async () => {\n    if (this.wallet !== undefined) {\n      await api.saveState(this.wallet, this.testConfig.cacheFileName);\n    }\n  };\n}",
    "counter-cli/src/test/counter.api.test.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { type Resource } from '@midnight-ntwrk/wallet';\nimport { type Wallet } from '@midnight-ntwrk/wallet-api';\nimport path from 'path';\nimport * as api from '../api';\nimport { type CounterProviders } from '../common-types';\nimport { currentDir } from '../config';\nimport { createLogger } from '../logger-utils';\nimport { TestEnvironment } from './commons';\nimport { describe, it, expect, beforeAll, afterAll } from 'vitest';\n\nconst logDir = path.resolve(currentDir, '..', 'logs', 'tests', `${new Date().toISOString()}.log`);\nconst logger = await createLogger(logDir);\n\ndescribe('API', () => {\n  let testEnvironment: TestEnvironment;\n  let wallet: Wallet & Resource;\n  let providers: CounterProviders;\n\n  beforeAll(\n    async () => {\n      api.setLogger(logger);\n      testEnvironment = new TestEnvironment(logger);\n      const testConfiguration = await testEnvironment.start();\n      wallet = await testEnvironment.getWallet();\n      providers = await api.configureProviders(wallet, testConfiguration.dappConfig);\n    },\n    1000 * 60 * 45,\n  );\n\n  afterAll(async () => {\n    await testEnvironment.saveWalletCache();\n    await testEnvironment.shutdown();\n  });\n\n  it('should deploy the contract and increment the counter [@slow]', async () => {\n    const counterContract = await api.deploy(providers, { privateCounter: 0 });\n    expect(counterContract).not.toBeNull();\n\n    const counter = await api.displayCounterValue(providers, counterContract);\n    expect(counter.counterValue).toEqual(BigInt(0));\n\n    await new Promise((resolve) => setTimeout(resolve, 2000));\n    const response = await api.increment(counterContract);\n    expect(response.txHash).toMatch(/[0-9a-f]{64}/);\n    expect(response.blockHeight).toBeGreaterThan(BigInt(0));\n\n    const counterAfter = await api.displayCounterValue(providers, counterContract);\n    expect(counterAfter.counterValue).toEqual(BigInt(1));\n    expect(counterAfter.contractAddress).toEqual(counter.contractAddress);\n  });\n});",
    "counter-cli/src/api.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\nimport { type ContractAddress } from '@midnight-ntwrk/compact-runtime';\nimport { Counter, type CounterPrivateState, witnesses } from '@midnight-ntwrk/counter-contract';\nimport { type CoinInfo, nativeToken, Transaction, type TransactionId } from '@midnight-ntwrk/ledger';\nimport { deployContract, findDeployedContract } from '@midnight-ntwrk/midnight-js-contracts';\nimport { httpClientProofProvider } from '@midnight-ntwrk/midnight-js-http-client-proof-provider';\nimport { indexerPublicDataProvider } from '@midnight-ntwrk/midnight-js-indexer-public-data-provider';\nimport { NodeZkConfigProvider } from '@midnight-ntwrk/midnight-js-node-zk-config-provider';\nimport {\n  type BalancedTransaction,\n  createBalancedTx,\n  type FinalizedTxData,\n  type MidnightProvider,\n  type UnbalancedTransaction,\n  type WalletProvider,\n} from '@midnight-ntwrk/midnight-js-types';\nimport { type Resource, WalletBuilder } from '@midnight-ntwrk/wallet';\nimport { type Wallet } from '@midnight-ntwrk/wallet-api';\nimport { Transaction as ZswapTransaction } from '@midnight-ntwrk/zswap';\nimport { webcrypto } from 'crypto';\nimport { type Logger } from 'pino';\nimport * as Rx from 'rxjs';\nimport { WebSocket } from 'ws';\nimport {\n  type CounterContract,\n  type CounterPrivateStateId,\n  type CounterProviders,\n  type DeployedCounterContract,\n} from './common-types';\nimport { type Config, contractConfig } from './config';\nimport { levelPrivateStateProvider } from '@midnight-ntwrk/midnight-js-level-private-state-provider';\nimport { assertIsContractAddress, toHex } from '@midnight-ntwrk/midnight-js-utils';\nimport { getLedgerNetworkId, getZswapNetworkId } from '@midnight-ntwrk/midnight-js-network-id';\nimport * as fsAsync from 'node:fs/promises';\nimport * as fs from 'node:fs';\n\nlet logger: Logger;\n// Instead of setting globalThis.crypto which is read-only, we'll ensure crypto is available\n// but won't try to overwrite the global property\n// @ts-expect-error: It's needed to enable WebSocket usage through apollo\nglobalThis.WebSocket = WebSocket;\n\nexport const getCounterLedgerState = async (\n  providers: CounterProviders,\n  contractAddress: ContractAddress,\n): Promise<bigint | null> => {\n  assertIsContractAddress(contractAddress);\n  logger.info('Checking contract ledger state...');\n  const state = await providers.publicDataProvider\n    .queryContractState(contractAddress)\n    .then((contractState) => (contractState != null ? Counter.ledger(contractState.data).round : null));\n  logger.info(`Ledger state: ${state}`);\n  return state;\n};\n\nexport const counterContractInstance: CounterContract = new Counter.Contract(witnesses);\n\nexport const joinContract = async (\n  providers: CounterProviders,\n  contractAddress: string,\n): Promise<DeployedCounterContract> => {\n  const counterContract = await findDeployedContract(providers, {\n    contractAddress,\n    contract: counterContractInstance,\n    privateStateId: 'counterPrivateState',\n    initialPrivateState: { privateCounter: 0 },\n  });\n  logger.info(`Joined contract at address: ${counterContract.deployTxData.public.contractAddress}`);\n  return counterContract;\n};\n\nexport const deploy = async (\n  providers: CounterProviders,\n  privateState: CounterPrivateState,\n): Promise<DeployedCounterContract> => {\n  logger.info('Deploying counter contract...');\n  const counterContract = await deployContract(providers, {\n    contract: counterContractInstance,\n    privateStateId: 'counterPrivateState',\n    initialPrivateState: privateState,\n  });\n  logger.info(`Deployed contract at address: ${counterContract.deployTxData.public.contractAddress}`);\n  return counterContract;\n};\n\nexport const increment = async (counterContract: DeployedCounterContract): Promise<FinalizedTxData> => {\n  logger.info('Incrementing...');\n  const finalizedTxData = await counterContract.callTx.increment();\n  logger.info(`Transaction ${finalizedTxData.public.txId} added in block ${finalizedTxData.public.blockHeight}`);\n  return finalizedTxData.public;\n};\n\nexport const displayCounterValue = async (\n  providers: CounterProviders,\n  counterContract: DeployedCounterContract,\n): Promise<{ counterValue: bigint | null; contractAddress: string }> => {\n  const contractAddress = counterContract.deployTxData.public.contractAddress;\n  const counterValue = await getCounterLedgerState(providers, contractAddress);\n  if (counterValue === null) {\n    logger.info(`There is no counter contract deployed at ${contractAddress}.`);\n  } else {\n    logger.info(`Current counter value: ${Number(counterValue)}`);\n  }\n  return { contractAddress, counterValue };\n};\n\nexport const createWalletAndMidnightProvider = async (wallet: Wallet): Promise<WalletProvider & MidnightProvider> => {\n  const state = await Rx.firstValueFrom(wallet.state());\n  return {\n    coinPublicKey: state.coinPublicKey,\n    encryptionPublicKey: state.encryptionPublicKey,\n    balanceTx(tx: UnbalancedTransaction, newCoins: CoinInfo[]): Promise<BalancedTransaction> {\n      return wallet\n        .balanceTransaction(\n          ZswapTransaction.deserialize(tx.serialize(getLedgerNetworkId()), getZswapNetworkId()),\n          newCoins,\n        )\n        .then((tx) => wallet.proveTransaction(tx))\n        .then((zswapTx) => Transaction.deserialize(zswapTx.serialize(getZswapNetworkId()), getLedgerNetworkId()))\n        .then(createBalancedTx);\n    },\n    submitTx(tx: BalancedTransaction): Promise<TransactionId> {\n      return wallet.submitTransaction(tx);\n    },\n  };\n};\n\nexport const waitForSync = (wallet: Wallet) =>\n  Rx.firstValueFrom(\n    wallet.state().pipe(\n      Rx.throttleTime(5_000),\n      Rx.tap((state) => {\n        const applyGap = state.syncProgress?.lag.applyGap ?? 0n;\n        const sourceGap = state.syncProgress?.lag.sourceGap ?? 0n;\n        logger.info(\n          `Waiting for funds. Backend lag: ${sourceGap}, wallet lag: ${applyGap}, transactions=${state.transactionHistory.length}`,\n        );\n      }),\n      Rx.filter((state) => {\n        // Let's allow progress only if wallet is synced fully\n        return state.syncProgress !== undefined && state.syncProgress.synced;\n      }),\n    ),\n  );\n\nexport const waitForSyncProgress = async (wallet: Wallet) =>\n  await Rx.firstValueFrom(\n    wallet.state().pipe(\n      Rx.throttleTime(5_000),\n      Rx.tap((state) => {\n        const applyGap = state.syncProgress?.lag.applyGap ?? 0n;\n        const sourceGap = state.syncProgress?.lag.sourceGap ?? 0n;\n        logger.info(\n          `Waiting for funds. Backend lag: ${sourceGap}, wallet lag: ${applyGap}, transactions=${state.transactionHistory.length}`,\n        );\n      }),\n      Rx.filter((state) => {\n        // Let's allow progress only if syncProgress is defined\n        return state.syncProgress !== undefined;\n      }),\n    ),\n  );\n\nexport const waitForFunds = (wallet: Wallet) =>\n  Rx.firstValueFrom(\n    wallet.state().pipe(\n      Rx.throttleTime(10_000),\n      Rx.tap((state) => {\n        const applyGap = state.syncProgress?.lag.applyGap ?? 0n;\n        const sourceGap = state.syncProgress?.lag.sourceGap ?? 0n;\n        logger.info(\n          `Waiting for funds. Backend lag: ${sourceGap}, wallet lag: ${applyGap}, transactions=${state.transactionHistory.length}`,\n        );\n      }),\n      Rx.filter((state) => {\n        // Let's allow progress only if wallet is synced\n        return state.syncProgress?.synced === true;\n      }),\n      Rx.map((s) => s.balances[nativeToken()] ?? 0n),\n      Rx.filter((balance) => balance > 0n),\n    ),\n  );\n\nexport const buildWalletAndWaitForFunds = async (\n  { indexer, indexerWS, node, proofServer }: Config,\n  seed: string,\n  filename: string,\n): Promise<Wallet & Resource> => {\n  const directoryPath = process.env.SYNC_CACHE;\n  let wallet: Wallet & Resource;\n  if (directoryPath !== undefined) {\n    if (fs.existsSync(`${directoryPath}/${filename}`)) {\n      logger.info(`Attempting to restore state from ${directoryPath}/${filename}`);\n      try {\n        const serializedStream = fs.createReadStream(`${directoryPath}/${filename}`, 'utf-8');\n        const serialized = await streamToString(serializedStream);\n        serializedStream.on('finish', () => {\n          serializedStream.close();\n        });\n        wallet = await WalletBuilder.restore(indexer, indexerWS, proofServer, node, seed, serialized, 'info');\n        wallet.start();\n        const stateObject = JSON.parse(serialized);\n        if ((await isAnotherChain(wallet, Number(stateObject.offset))) === true) {\n          logger.warn('The chain was reset, building wallet from scratch');\n          wallet = await WalletBuilder.buildFromSeed(\n            indexer,\n            indexerWS,\n            proofServer,\n            node,\n            seed,\n            getZswapNetworkId(),\n            'info',\n          );\n          wallet.start();\n        } else {\n          const newState = await waitForSync(wallet);\n          // allow for situations when there's no new index in the network between runs\n          if (newState.syncProgress?.synced) {\n            logger.info('Wallet was able to sync from restored state');\n          } else {\n            logger.info(`Offset: ${stateObject.offset}`);\n            logger.info(`SyncProgress.lag.applyGap: ${newState.syncProgress?.lag.applyGap}`);\n            logger.info(`SyncProgress.lag.sourceGap: ${newState.syncProgress?.lag.sourceGap}`);\n            logger.warn('Wallet was not able to sync from restored state, building wallet from scratch');\n            wallet = await WalletBuilder.buildFromSeed(\n              indexer,\n              indexerWS,\n              proofServer,\n              node,\n              seed,\n              getZswapNetworkId(),\n              'info',\n            );\n            wallet.start();\n          }\n        }\n      } catch (error: unknown) {\n        if (typeof error === 'string') {\n          logger.error(error);\n        } else if (error instanceof Error) {\n          logger.error(error.message);\n        } else {\n          logger.error(error);\n        }\n        logger.warn('Wallet was not able to restore using the stored state, building wallet from scratch');\n        wallet = await WalletBuilder.buildFromSeed(\n          indexer,\n          indexerWS,\n          proofServer,\n          node,\n          seed,\n          getZswapNetworkId(),\n          'info',\n        );\n        wallet.start();\n      }\n    } else {\n      logger.info('Wallet save file not found, building wallet from scratch');\n      wallet = await WalletBuilder.buildFromSeed(\n        indexer,\n        indexerWS,\n        proofServer,\n        node,\n        seed,\n        getZswapNetworkId(),\n        'info',\n      );\n      wallet.start();\n    }\n  } else {\n    logger.info('File path for save file not found, building wallet from scratch');\n    wallet = await WalletBuilder.buildFromSeed(\n      indexer,\n      indexerWS,\n      proofServer,\n      node,\n      seed,\n      getZswapNetworkId(),\n      'info',\n    );\n    wallet.start();\n  }\n\n  const state = await Rx.firstValueFrom(wallet.state());\n  logger.info(`Your wallet seed is: ${seed}`);\n  logger.info(`Your wallet address is: ${state.address}`);\n  let balance = state.balances[nativeToken()];\n  if (balance === undefined || balance === 0n) {\n    logger.info(`Your wallet balance is: 0`);\n    logger.info(`Waiting to receive tokens...`);\n    balance = await waitForFunds(wallet);\n  }\n  logger.info(`Your wallet balance is: ${balance}`);\n  return wallet;\n};\n\nexport const randomBytes = (length: number): Uint8Array => {\n  const bytes = new Uint8Array(length);\n  webcrypto.getRandomValues(bytes);\n  return bytes;\n};\n\nexport const buildFreshWallet = async (config: Config): Promise<Wallet & Resource> =>\n  await buildWalletAndWaitForFunds(config, toHex(randomBytes(32)), '');\n\nexport const configureProviders = async (wallet: Wallet & Resource, config: Config) => {\n  const walletAndMidnightProvider = await createWalletAndMidnightProvider(wallet);\n  return {\n    privateStateProvider: levelPrivateStateProvider<typeof CounterPrivateStateId>({\n      privateStateStoreName: contractConfig.privateStateStoreName,\n    }),\n    publicDataProvider: indexerPublicDataProvider(config.indexer, config.indexerWS),\n    zkConfigProvider: new NodeZkConfigProvider<'increment'>(contractConfig.zkConfigPath),\n    proofProvider: httpClientProofProvider(config.proofServer),\n    walletProvider: walletAndMidnightProvider,\n    midnightProvider: walletAndMidnightProvider,\n  };\n};\n\nexport function setLogger(_logger: Logger) {\n  logger = _logger;\n}\n\nexport const streamToString = async (stream: fs.ReadStream): Promise<string> => {\n  const chunks: Buffer[] = [];\n  return await new Promise((resolve, reject) => {\n    stream.on('data', (chunk) => chunks.push(typeof chunk === 'string' ? Buffer.from(chunk, 'utf8') : chunk));\n    stream.on('error', (err) => {\n      reject(err);\n    });\n    stream.on('end', () => {\n      resolve(Buffer.concat(chunks).toString('utf8'));\n    });\n  });\n};\n\nexport const isAnotherChain = async (wallet: Wallet, offset: number) => {\n  await waitForSyncProgress(wallet);\n  // Here wallet does not expose the offset block it is synced to, that is why this workaround\n  const walletOffset = Number(JSON.parse(await wallet.serializeState()).offset);\n  if (walletOffset < offset - 1) {\n    logger.info(`Your offset offset is: ${walletOffset} restored offset: ${offset} so it is another chain`);\n    return true;\n  } else {\n    logger.info(`Your offset offset is: ${walletOffset} restored offset: ${offset} ok`);\n    return false;\n  }\n};\n\nexport const saveState = async (wallet: Wallet, filename: string) => {\n  const directoryPath = process.env.SYNC_CACHE;\n  if (directoryPath !== undefined) {\n    logger.info(`Saving state in ${directoryPath}/${filename}`);\n    try {\n      await fsAsync.mkdir(directoryPath, { recursive: true });\n      const serializedState = await wallet.serializeState();\n      const writer = fs.createWriteStream(`${directoryPath}/${filename}`);\n      writer.write(serializedState);\n\n      writer.on('finish', function () {\n        logger.info(`File '${directoryPath}/${filename}' written successfully.`);\n      });\n\n      writer.on('error', function (err) {\n        logger.error(err);\n      });\n      writer.end();\n    } catch (e) {\n      if (typeof e === 'string') {\n        logger.warn(e);\n      } else if (e instanceof Error) {\n        logger.warn(e.message);\n      }\n    }\n  } else {\n    logger.info('Not saving cache as sync cache was not defined');\n  }\n};",
    "counter-cli/src/cli.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { type Resource } from '@midnight-ntwrk/wallet';\nimport { type Wallet } from '@midnight-ntwrk/wallet-api';\nimport { stdin as input, stdout as output } from 'node:process';\nimport { createInterface, type Interface } from 'node:readline/promises';\nimport { type Logger } from 'pino';\nimport { type StartedDockerComposeEnvironment, type DockerComposeEnvironment } from 'testcontainers';\nimport { type CounterProviders, type DeployedCounterContract } from './common-types';\nimport { type Config, StandaloneConfig } from './config';\nimport * as api from './api';\n\nlet logger: Logger;\n\n/**\n * This seed gives access to tokens minted in the genesis block of a local development node - only\n * used in standalone networks to build a wallet with initial funds.\n */\nconst GENESIS_MINT_WALLET_SEED = '0000000000000000000000000000000000000000000000000000000000000001';\n\nconst DEPLOY_OR_JOIN_QUESTION = `\nYou can do one of the following:\n  1. Deploy a new counter contract\n  2. Join an existing counter contract\n  3. Exit\nWhich would you like to do? `;\n\nconst MAIN_LOOP_QUESTION = `\nYou can do one of the following:\n  1. Increment\n  2. Display current counter value\n  3. Exit\nWhich would you like to do? `;\n\nconst join = async (providers: CounterProviders, rli: Interface): Promise<DeployedCounterContract> => {\n  const contractAddress = await rli.question('What is the contract address (in hex)? ');\n  return await api.joinContract(providers, contractAddress);\n};\n\nconst deployOrJoin = async (providers: CounterProviders, rli: Interface): Promise<DeployedCounterContract | null> => {\n  while (true) {\n    const choice = await rli.question(DEPLOY_OR_JOIN_QUESTION);\n    switch (choice) {\n      case '1':\n        return await api.deploy(providers, { privateCounter: 0 });\n      case '2':\n        return await join(providers, rli);\n      case '3':\n        logger.info('Exiting...');\n        return null;\n      default:\n        logger.error(`Invalid choice: ${choice}`);\n    }\n  }\n};\n\nconst mainLoop = async (providers: CounterProviders, rli: Interface): Promise<void> => {\n  const counterContract = await deployOrJoin(providers, rli);\n  if (counterContract === null) {\n    return;\n  }\n  while (true) {\n    const choice = await rli.question(MAIN_LOOP_QUESTION);\n    switch (choice) {\n      case '1':\n        await api.increment(counterContract);\n        break;\n      case '2':\n        await api.displayCounterValue(providers, counterContract);\n        break;\n      case '3':\n        logger.info('Exiting...');\n        return;\n      default:\n        logger.error(`Invalid choice: ${choice}`);\n    }\n  }\n};\n\nconst buildWalletFromSeed = async (config: Config, rli: Interface): Promise<Wallet & Resource> => {\n  const seed = await rli.question('Enter your wallet seed: ');\n  return await api.buildWalletAndWaitForFunds(config, seed, '');\n};\n\nconst WALLET_LOOP_QUESTION = `\nYou can do one of the following:\n  1. Build a fresh wallet\n  2. Build wallet from a seed\n  3. Exit\nWhich would you like to do? `;\n\nconst buildWallet = async (config: Config, rli: Interface): Promise<(Wallet & Resource) | null> => {\n  if (config instanceof StandaloneConfig) {\n    return await api.buildWalletAndWaitForFunds(config, GENESIS_MINT_WALLET_SEED, '');\n  }\n  while (true) {\n    const choice = await rli.question(WALLET_LOOP_QUESTION);\n    switch (choice) {\n      case '1':\n        return await api.buildFreshWallet(config);\n      case '2':\n        return await buildWalletFromSeed(config, rli);\n      case '3':\n        logger.info('Exiting...');\n        return null;\n      default:\n        logger.error(`Invalid choice: ${choice}`);\n    }\n  }\n};\n\nconst mapContainerPort = (env: StartedDockerComposeEnvironment, url: string, containerName: string) => {\n  const mappedUrl = new URL(url);\n  const container = env.getContainer(containerName);\n\n  mappedUrl.port = String(container.getFirstMappedPort());\n\n  return mappedUrl.toString().replace(/\\/+$/, '');\n};\n\nexport const run = async (config: Config, _logger: Logger, dockerEnv?: DockerComposeEnvironment): Promise<void> => {\n  logger = _logger;\n  api.setLogger(_logger);\n  const rli = createInterface({ input, output, terminal: true });\n  let env;\n  if (dockerEnv !== undefined) {\n    env = await dockerEnv.up();\n\n    if (config instanceof StandaloneConfig) {\n      config.indexer = mapContainerPort(env, config.indexer, 'counter-indexer');\n      config.indexerWS = mapContainerPort(env, config.indexerWS, 'counter-indexer');\n      config.node = mapContainerPort(env, config.node, 'counter-node');\n      config.proofServer = mapContainerPort(env, config.proofServer, 'counter-proof-server');\n    }\n  }\n  const wallet = await buildWallet(config, rli);\n  try {\n    if (wallet !== null) {\n      const providers = await api.configureProviders(wallet, config);\n      await mainLoop(providers, rli);\n    }\n  } catch (e) {\n    if (e instanceof Error) {\n      logger.error(`Found error '${e.message}'`);\n      logger.info('Exiting...');\n      logger.debug(`${e.stack}`);\n    } else {\n      throw e;\n    }\n  } finally {\n    try {\n      rli.close();\n      rli.removeAllListeners();\n    } catch (e) {\n      logger.error(`Error closing readline interface: ${e}`);\n    } finally {\n      try {\n        if (wallet !== null) {\n          await wallet.close();\n        }\n      } catch (e) {\n        logger.error(`Error closing wallet: ${e}`);\n      } finally {\n        try {\n          if (env !== undefined) {\n            await env.down();\n            logger.info('Goodbye');\n          }\n        } catch (e) {\n          logger.error(`Error shutting down docker environment: ${e}`);\n        }\n      }\n    }\n  }\n};",
    "counter-cli/src/common-types.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Counter, type CounterPrivateState } from '@midnight-ntwrk/counter-contract';\nimport type { ImpureCircuitId, MidnightProviders } from '@midnight-ntwrk/midnight-js-types';\nimport type { DeployedContract, FoundContract } from '@midnight-ntwrk/midnight-js-contracts';\n\nexport type CounterCircuits = ImpureCircuitId<Counter.Contract<CounterPrivateState>>;\n\nexport const CounterPrivateStateId = 'counterPrivateState';\n\nexport type CounterProviders = MidnightProviders<CounterCircuits, typeof CounterPrivateStateId, CounterPrivateState>;\n\nexport type CounterContract = Counter.Contract<CounterPrivateState>;\n\nexport type DeployedCounterContract = DeployedContract<CounterContract> | FoundContract<CounterContract>;",
    "counter-cli/src/config.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport path from 'node:path';\nimport { NetworkId, setNetworkId } from '@midnight-ntwrk/midnight-js-network-id';\nexport const currentDir = path.resolve(new URL(import.meta.url).pathname, '..');\n\nexport const contractConfig = {\n  privateStateStoreName: 'counter-private-state',\n  zkConfigPath: path.resolve(currentDir, '..', '..', 'contract', 'src', 'managed', 'counter'),\n};\n\nexport interface Config {\n  readonly logDir: string;\n  readonly indexer: string;\n  readonly indexerWS: string;\n  readonly node: string;\n  readonly proofServer: string;\n}\n\nexport class TestnetLocalConfig implements Config {\n  logDir = path.resolve(currentDir, '..', 'logs', 'testnet-local', `${new Date().toISOString()}.log`);\n  indexer = 'http://127.0.0.1:8088/api/v1/graphql';\n  indexerWS = 'ws://127.0.0.1:8088/api/v1/graphql/ws';\n  node = 'http://127.0.0.1:9944';\n  proofServer = 'http://127.0.0.1:6300';\n  constructor() {\n    setNetworkId(NetworkId.TestNet);\n  }\n}\n\nexport class StandaloneConfig implements Config {\n  logDir = path.resolve(currentDir, '..', 'logs', 'standalone', `${new Date().toISOString()}.log`);\n  indexer = 'http://127.0.0.1:8088/api/v1/graphql';\n  indexerWS = 'ws://127.0.0.1:8088/api/v1/graphql/ws';\n  node = 'http://127.0.0.1:9944';\n  proofServer = 'http://127.0.0.1:6300';\n  constructor() {\n    setNetworkId(NetworkId.Undeployed);\n  }\n}\n\nexport class TestnetRemoteConfig implements Config {\n  logDir = path.resolve(currentDir, '..', 'logs', 'testnet-remote', `${new Date().toISOString()}.log`);\n  indexer = 'https://indexer.testnet-02.midnight.network/api/v1/graphql';\n  indexerWS = 'wss://indexer.testnet-02.midnight.network/api/v1/graphql/ws';\n  node = 'https://rpc.testnet-02.midnight.network';\n  proofServer = 'http://127.0.0.1:6300';\n  constructor() {\n    setNetworkId(NetworkId.TestNet);\n  }\n}",
    "counter-cli/src/index.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nexport * from './api';\nexport * from './cli';",
    "counter-cli/src/logger-utils.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport * as path from 'node:path';\nimport * as fs from 'node:fs/promises';\nimport pinoPretty from 'pino-pretty';\nimport pino from 'pino';\nimport { createWriteStream } from 'node:fs';\n\nexport const createLogger = async (logPath: string): Promise<pino.Logger> => {\n  await fs.mkdir(path.dirname(logPath), { recursive: true });\n  const pretty: pinoPretty.PrettyStream = pinoPretty({\n    colorize: true,\n    sync: true,\n  });\n  const level =\n    process.env.DEBUG_LEVEL !== undefined && process.env.DEBUG_LEVEL !== null && process.env.DEBUG_LEVEL !== ''\n      ? process.env.DEBUG_LEVEL\n      : 'info';\n  return pino(\n    {\n      level,\n      depthLimit: 20,\n    },\n    pino.multistream([\n      { stream: pretty, level },\n      { stream: createWriteStream(logPath), level },\n    ]),\n  );\n};",
    "counter-cli/src/standalone.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { createLogger } from './logger-utils.js';\nimport path from 'node:path';\nimport { run } from './cli.js';\nimport { DockerComposeEnvironment, Wait } from 'testcontainers';\nimport { currentDir, StandaloneConfig } from './config.js';\n\nconst config = new StandaloneConfig();\nconst dockerEnv = new DockerComposeEnvironment(path.resolve(currentDir, '..'), 'standalone.yml')\n  .withWaitStrategy('counter-proof-server', Wait.forLogMessage('Actix runtime found; starting in Actix runtime', 1))\n  .withWaitStrategy('counter-indexer', Wait.forLogMessage(/starting indexing/, 1));\nconst logger = await createLogger(config.logDir);\nawait run(config, logger, dockerEnv);",
    "counter-cli/src/testnet-local.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { createLogger } from './logger-utils.js';\nimport { run } from './cli.js';\nimport { TestnetLocalConfig } from './config.js';\n\nconst config = new TestnetLocalConfig();\nconst logger = await createLogger(config.logDir);\nawait run(config, logger);",
    "counter-cli/src/testnet-remote-start-proof-server.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { createLogger } from './logger-utils.js';\nimport { run } from './cli.js';\nimport { currentDir, TestnetRemoteConfig } from './config.js';\nimport { DockerComposeEnvironment, Wait } from 'testcontainers';\nimport path from 'node:path';\n\nconst config = new TestnetRemoteConfig();\nconst dockerEnv = new DockerComposeEnvironment(\n  path.resolve(currentDir, '..'),\n  'proof-server-testnet.yml',\n).withWaitStrategy('proof-server', Wait.forLogMessage('Actix runtime found; starting in Actix runtime', 1));\nconst logger = await createLogger(config.logDir);\nawait run(config, logger, dockerEnv);",
    "counter-cli/src/testnet-remote.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { createLogger } from './logger-utils.js';\nimport { run } from './cli.js';\nimport { TestnetRemoteConfig } from './config.js';\n\nconst config = new TestnetRemoteConfig();\nconst logger = await createLogger(config.logDir);\nawait run(config, logger);",
    "counter-cli/.prettierrc.json": "{\n  \"semi\": true,\n  \"trailingComma\": \"all\",\n  \"singleQuote\": true,\n  \"printWidth\": 120\n}",
    "counter-cli/eslint.config.mjs": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport js from '@eslint/js';\nimport plugin from '@typescript-eslint/eslint-plugin';\nimport parser from '@typescript-eslint/parser';\nimport pluginPrettier from 'eslint-plugin-prettier';\n\nexport default [\n  js.configs.recommended,\n  {\n    files: ['**/*.ts', '**/*.tsx'],\n    languageOptions: {\n      parser,\n      parserOptions: {\n        ecmaVersion: 'latest',\n        sourceType: 'module',\n        project: ['./tsconfig.json'],\n      },\n      globals: {\n        process: 'readonly',\n        Buffer: 'readonly',\n        URL: 'readonly',\n        setTimeout: 'readonly',\n      },\n    },\n    plugins: {\n      '@typescript-eslint': plugin,\n      prettier: pluginPrettier,\n    },\n    rules: {\n      'prettier/prettier': 'error',\n      '@typescript-eslint/no-misused-promises': 'off',\n      '@typescript-eslint/no-floating-promises': 'warn',\n      '@typescript-eslint/promise-function-async': 'off',\n      '@typescript-eslint/no-redeclare': 'off',\n      '@typescript-eslint/explicit-function-return-type': 'off',\n      '@typescript-eslint/consistent-type-definitions': 'off',\n      '@typescript-eslint/no-unsafe-call': 'warn',\n      '@typescript-eslint/no-unsafe-return': 'warn',\n      '@typescript-eslint/no-unsafe-assignment': 'warn',\n      '@typescript-eslint/no-unsafe-member-access': 'warn',\n      '@typescript-eslint/no-unsafe-argument': 'warn',\n    },\n  },\n];",
    "counter-cli/package.json": "{\n  \"name\": \"@midnight-ntwrk/counter-cli\",\n  \"version\": \"0.1.0\",\n  \"license\": \"Apache-2.0\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"scripts\": {\n    \"testnet-remote\": \"node --experimental-specifier-resolution=node --loader ts-node/esm src/testnet-remote.ts\",\n    \"testnet-remote-ps\": \"cp -r proof-server-testnet.yml ./dist/ && node --experimental-specifier-resolution=node --loader ts-node/esm src/testnet-remote-start-proof-server.ts\",\n    \"testnet-local\": \"node --experimental-specifier-resolution=node --loader ts-node/esm src/testnet-local.ts\",\n    \"standalone\": \"docker compose -f standalone.yml pull && node --experimental-specifier-resolution=node --loader ts-node/esm src/standalone.ts\",\n    \"test-api\": \"docker compose -f standalone.yml pull && DEBUG='testcontainers' vitest run\",\n    \"test-against-testnet\": \"RUN_ENV_TESTS=true TEST_ENV=testnet TEST_WALLET_SEED=1dec0dd58fbe4d3206ef960aebff95a77e09dffbd19f3e9439d23fe6de4fcdd1 vitest run\",\n    \"build\": \"rm -rf dist && tsc --project tsconfig.build.json\",\n    \"lint\": \"eslint src\",\n    \"typecheck\": \"tsc -p tsconfig.json --noEmit\",\n    \"start-testnet-remote\": \"npm run build && npm run testnet-remote\",\n    \"start-testnet-remote-ps\": \"npm run build && npm run testnet-remote-ps\"\n  },\n  \"dependencies\": {\n    \"@midnight-ntwrk/counter-contract\": \"*\"\n  }\n}",
    "counter-cli/proof-server-devnet.yml": "services:\n  proof-server:\n    image: \"midnightnetwork/proof-server:4.0.0\"\n    command: [\"midnight-proof-server --network devnet\"]\n    ports:\n      - \"6300:6300\"\n    environment:\n      RUST_BACKTRACE: \"full\"",
    "counter-cli/proof-server-testnet.yml": "services:\n  proof-server:\n    image: \"midnightnetwork/proof-server:4.0.0\"\n    command: [\"midnight-proof-server --network testnet\"]\n    ports:\n      - \"6300:6300\"\n    environment:\n      RUST_BACKTRACE: \"full\"",
    "counter-cli/proof-server.yml": "services:\n  proof-server:\n    image: \"midnightnetwork/proof-server:4.0.0\"\n    command: [\"midnight-proof-server --network undeployed\"]\n    ports:\n      - \"6300:6300\"\n    environment:\n      RUST_BACKTRACE: \"full\"",
    "counter-cli/standalone-latest.yml": "services:\n  proof-server:\n    container_name: 'counter-proof-server'\n    image: \"midnightnetwork/proof-server:4.0.0\"\n    ports:\n      - \"6300\"\n    environment:\n      RUST_BACKTRACE: \"full\"\n  indexer:\n    container_name: 'counter-indexer'\n    image: 'midnightntwrk/indexer-standalone:2.1.1'\n    ports:\n      - '0:8088'\n    environment:\n      RUST_LOG: \"indexer=info,chain_indexer=info,indexer_api=info,wallet_indexer=info,indexer_common=info,fastrace_opentelemetry=off,info\"\n      APP__INFRA__SECRET: \"303132333435363738393031323334353637383930313233343536373839303132\"\n      APP__INFRA__NODE__URL: \"ws://node:9944\"\n    depends_on:\n      node:\n        condition: service_started\n  node:\n    image: 'midnightnetwork/midnight-node:0.12.0'\n    container_name: 'counter-node'\n    ports:\n      - \"9944\"\n    healthcheck:\n      test: [ \"CMD\", \"curl\", \"-f\", \"http://localhost:9944/health\" ]\n      interval: 2s\n      timeout: 5s\n      retries: 5\n      start_period: 40s\n    environment:\n      CFG_PRESET: \"dev\"",
    "counter-cli/standalone.yml": "services:\n  proof-server:\n    container_name: 'counter-proof-server'\n    image: \"midnightnetwork/proof-server:4.0.0\"\n    ports:\n      - \"6300\"\n    environment:\n      RUST_BACKTRACE: \"full\"\n  indexer:\n    container_name: 'counter-indexer'\n    image: 'midnightntwrk/indexer-standalone:2.1.1'\n    ports:\n      - '0:8088'\n    environment:\n      RUST_LOG: \"indexer=info,chain_indexer=info,indexer_api=info,wallet_indexer=info,indexer_common=info,fastrace_opentelemetry=off,info\"\n      # Random 32-byte hex-encoded secret used to make the standalone indexer run.\n      # Only needed to satisfy the config schema – not meant for secure use.\n      APP__INFRA__SECRET: \"303132333435363738393031323334353637383930313233343536373839303132\"\n      APP__INFRA__NODE__URL: \"ws://node:9944\"\n    depends_on:\n      node:\n        condition: service_started\n  node:\n    image: 'midnightnetwork/midnight-node:0.12.0'\n    container_name: 'counter-node'\n    ports:\n      - \"9944\"\n    healthcheck:\n      test: [ \"CMD\", \"curl\", \"-f\", \"http://localhost:9944/health\" ]\n      interval: 2s\n      timeout: 5s\n      retries: 5\n      start_period: 40s\n    environment:\n      CFG_PRESET: \"dev\"",
    "counter-cli/tsconfig.build.json": "{\n  \"extends\": \"./tsconfig.json\",\n  \"exclude\": [\"src/**/*.test.ts\"],\n  \"compilerOptions\": {}\n}",
    "counter-cli/tsconfig.json": "{\n  \"include\": [\"src/**/*.ts\"],\n  \"compilerOptions\": {\n    // \"rootDir\": \"src\",\n    \"outDir\": \"dist\",\n    \"declaration\": true,\n    \"lib\": [\"ESNext\"],\n    \"target\": \"ES2022\",\n    \"module\": \"ESNext\",\n    \"moduleResolution\": \"node\",\n    \"allowJs\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"noImplicitAny\": true,\n    \"strict\": true,\n    \"isolatedModules\": true,\n    \"sourceMap\": true,\n    \"resolveJsonModule\": true,\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true,\n    \"baseUrl\": \".\",\n    \"paths\": {\n      \"@contract/*\": [\"../../contract/src/*\"]\n    }\n  }\n}",
    "counter-cli/vitest.config.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { defineConfig } from 'vitest/config';\n\nexport default defineConfig({\n  mode: 'node',\n  test: {\n    setupFiles: ['./vitest.setup.ts'],\n    testTimeout: 1000 * 60 * 45,\n    deps: {\n      interopDefault: true,\n    },\n    globals: true,\n    environment: 'node',\n    include: ['**/*.test.ts'],\n    exclude: ['node_modules'],\n    root: '.',\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'json', 'html'],\n      thresholds: {\n        branches: 50,\n        functions: 73,\n        lines: 72,\n        statements: -269,\n      },\n    },\n    reporters: ['default', ['junit', { outputFile: 'reports/report.xml' }]],\n  },\n  resolve: {\n    extensions: ['.ts', '.js'],\n    conditions: ['import', 'node', 'default'],\n  },\n});",
    "counter-cli/vitest.setup.ts": "// This file is part of midnightntwrk/example-counter.\n// Copyright (C) 2025 Midnight Foundation\n// SPDX-License-Identifier: Apache-2.0\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// You may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport protobuf from 'protobufjs';\nimport Long from 'long';\n\nprotobuf.util.Long = Long;\nprotobuf.configure();",
    ".gitignore": "# Node.js\nnode_modules/\ndist/\nbuild/\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\n\n# TypeScript\n*.tsbuildinfo\n\n# Logs\nlogs\n*.log\nlogs/*.log\nmidnight-level-db\ncoverage\n\n# Test reports\n**/reports\n\n# Dependency directories\njspm_packages/\n\n# Optional npm cache directory\n.npm\n\n# Optional eslint cache\n.eslintcache\n\n# Optional REPL history\n.node_repl_history\n\n# Output of 'npm pack'\n*.tgz\n\n# Yarn Integrity file\n.yarn-integrity\n\n# dotenv environment variables file\n.env\n\n# MacOS\n.DS_Store\n\n# VSCode\n.vscode/*\n!.vscode/settings.json\n!.vscode/tasks.json\n!.vscode/launch.json\n!.vscode/extensions.json\n\n# IDEs and editors\n.idea/\n*.suo\n*.ntvs*\n*.njsproj\n*.sln\n\n# Compact\nmanaged/",
    "package.json": "{\n  \"name\": \"example-counter\",\n  \"version\": \"2.0.2\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"workspaces\": [\n    \"counter-cli\",\n    \"contract\"\n  ],\n  \"devDependencies\": {\n    \"@eslint/js\": \"^9.39.1\",\n    \"@types/node\": \"^25.0.1\",\n    \"@types/ws\": \"^8.18.1\",\n    \"@typescript-eslint/eslint-plugin\": \"^8.48.1\",\n    \"@typescript-eslint/parser\": \"^8.49.0\",\n    \"eslint\": \"^9.39.1\",\n    \"eslint-config-prettier\": \"^10.1.8\",\n    \"eslint-plugin-prettier\": \"^5.5.4\",\n    \"testcontainers\": \"^11.10.0\",\n    \"ts-node\": \"^10.9.2\",\n    \"typescript\": \"^5.9.3\",\n    \"vitest\": \"^4.0.15\"\n  },\n  \"dependencies\": {\n    \"@midnight-ntwrk/compact-runtime\": \"^0.9.0\",\n    \"@midnight-ntwrk/ledger\": \"^4.0.0\",\n    \"@midnight-ntwrk/midnight-js-contracts\": \"2.0.2\",\n    \"@midnight-ntwrk/midnight-js-http-client-proof-provider\": \"2.0.2\",\n    \"@midnight-ntwrk/midnight-js-indexer-public-data-provider\": \"2.0.2\",\n    \"@midnight-ntwrk/midnight-js-level-private-state-provider\": \"2.0.2\",\n    \"@midnight-ntwrk/midnight-js-node-zk-config-provider\": \"2.0.2\",\n    \"@midnight-ntwrk/midnight-js-types\": \"2.0.2\",\n    \"@midnight-ntwrk/wallet\": \"5.0.0\",\n    \"@midnight-ntwrk/wallet-api\": \"5.0.0\",\n    \"@midnight-ntwrk/zswap\": \"^4.0.0\",\n    \"pino\": \"^10.1.0\",\n    \"pino-pretty\": \"^13.1.3\",\n    \"ws\": \"^8.18.3\"\n  }\n}",
    "README.md": "# Counter DApp\n\n[![Generic badge](https://img.shields.io/badge/Compact%20Compiler-0.25.0-1abc9c.svg)](https://shields.io/) [![Generic badge](https://img.shields.io/badge/TypeScript-5.8.3-blue.svg)](https://shields.io/)\n\nA Midnight smart contract example demonstrating counter functionality with zero-knowledge proofs on testnet.\n\n## Project Structure\n\n```\nexample-counter/\n├── contract/               # Smart contract in Compact language\n│   ├── src/counter.compact # The actual smart contract\n│   └── src/test/           # Contract unit tests\n└── counter-cli/            # Command-line interface\n    └── src/                # CLI implementation\n```\n\n## Prerequisites\n\n### 1. Node.js Version Check\n\nYou need NodeJS version 22.15 or greater:\n\n```bash\nnode --version\n```\n\nExpected output: `v22.15.0` or higher.\n\nIf you get a lower version: [Install Node.js 22+](https://nodejs.org/).\n\n### 2. Docker Installation\n\nThe [proof server](https://docs.midnight.network/develop/tutorial/using/proof-server) runs in Docker, so you need Docker Desktop:\n\n```bash\ndocker --version\n```\n\nExpected output: `Docker version X.X.X`.\n\nIf Docker is not found: [Install Docker Desktop](https://docs.docker.com/desktop/). Make sure Docker Desktop is running (not just installed).\n\n## Setup Instructions\n\n### Install the Compact Compiler\n\nThe Compact compiler converts smart contracts written in the Compact language into executable circuits for zero-knowledge proof generation.\n\n#### Download and install compact compiler\n\n```bash\ncurl --proto '=https' --tlsv1.2 -LsSf https://github.com/midnightntwrk/compact/releases/latest/download/compact-installer.sh | sh\n```\n\n#### Add to your PATH (choose based on your shell)\n\n```bash\nsource $HOME/.local/bin/env                    # bash/zsh/sh\nsource $HOME/.local/bin/env.fish              # fish\n```\n\n#### Update to the version required by this project (optional)\n\n```\ncompact update 0.25.0\n```\n\n#### Verify installation\n\n```bash\ncompact compile --version\n```\n\nExpected output: `0.25.0`.\n\n> If command not found: Restart your terminal and try the `source` command again.\n\n### Install Project Dependencies\n\n```bash\nnpm install\n```\n\n### Compile the Smart Contract\n\nThe Compact compiler generates TypeScript bindings and zero-knowledge circuits from the smart contract source code. Navigate to contract directory and compile the smart contract:\n\n```bash\ncd contract && npm run compact\n```\n\nExpected output:\n\n```\nCompiling 1 circuits:\n  circuit \"increment\" (k=10, rows=29)\n```\n\nNote: First time may download zero-knowledge parameters (~500MB). This is normal and happens once.\n\n### Build and Test\n\nBuild TypeScript files and run tests:\n\n```bash\nnpm run build && npm run test\n```\n\n### Build the CLI Interface\n\nNavigate to CLI directory and build the project:\n\n```bash\ncd ../counter-cli && npm run build\n```\n\n### Start the Proof Server\n\nThe proof server generates zero-knowledge proofs for transactions locally to protect private data. It must be running before you can deploy or interact with contracts.\n\n#### Option A: Manual Proof Server (Recommended)\n\nPull the Docker image:\n\n```bash\ndocker pull midnightnetwork/proof-server:latest\n```\n\nThen start the proof server (keep this terminal open):\n\n```bash\ndocker run -p 6300:6300 midnightnetwork/proof-server -- 'midnight-proof-server --network testnet'\n```\n\nExpected output:\n\n```\nINFO midnight_proof_server: This proof server processes transactions for TestNet.\nINFO actix_server::server: starting service: \"actix-web-service-0.0.0.0:6300\"\n```\n\n**Keep this terminal running!** The proof server must stay active while using the DApp.\n\n#### Option B: Automatic Proof Server\n\nThis should start proof server automatically, but may fail if Docker isn't properly configured:\n\n```bash\nnpm run testnet-remote-ps\n```\n\nIf this fails with \"Could not find a working container runtime strategy\", use Option A instead.\n\n## Run the Counter DApp\n\nOpen a new terminal (keep proof server running in the first one).\n\n```bash\ncd counter-cli && npm run start-testnet-remote\n```\n\n## Using the Counter DApp\n\n### Create a Wallet\n\nThe CLI uses a headless wallet (separate from browser wallets like Lace) that can be called through library functions.\n\n1. Choose option `1` to build a fresh wallet\n2. The system will generate a wallet address and seed\n3. **Save both the address and seed** - you'll need them later\n\nExpected output:\n\n```\nYour wallet seed is: [64-character hex string]\nYour wallet address is: mn_shield-addr_test1...\nYour wallet balance is: 0\n```\n\n### Fund Your Wallet\n\nBefore deploying contracts, you need testnet tokens.\n\n1. Copy your wallet address from the output above\n2. Visit the [testnet faucet](https://midnight.network/test-faucet)\n3. Paste your address and request funds\n4. Wait for the CLI to detect the funds (takes 2-3 minutes)\n\nExpected output:\n\n```\nYour wallet balance is: 1000000000\n```\n\n### Deploy Your Contract\n\n1. Choose option `1` to deploy a new counter contract\n2. Wait for deployment (takes ~30 seconds)\n3. **Save the contract address** for future use\n\nExpected output:\n\n```\nDeployed contract at address: [contract address]\n```\n\n### Interact with Your Contract\n\nYou can now:\n\n- **Increment** the counter (submits a transaction to testnet)\n- **Display** current counter value (queries the blockchain)\n- **Exit** when done\n\nEach increment creates a real transaction on Midnight Testnet.\n\n### Reusing Your Wallet\n\nNext time you run the DApp:\n\n1. Choose option `2` to build wallet from seed\n2. Enter your saved seed\n3. Choose option `2` to join existing contract\n4. Enter your saved contract address\n\n## Useful Links\n\n- [Testnet Faucet](https://midnight.network/test-faucet) - Get testnet funds\n- [Midnight Documentation](https://docs.midnight.network/) - Complete developer guide\n- [Compact Language Guide](https://docs.midnight.network/compact) - Smart contract language reference\n\n## Troubleshooting\n\n| Issue                                               | Solution                                                                                                                |\n| --------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |\n| `compact: command not found`                        | Run `source $HOME/.local/bin/env` then `compact compile --version`                                                      |\n| `connect ECONNREFUSED 127.0.0.1:6300`               | Start proof server: `docker run -p 6300:6300 midnightnetwork/proof-server -- 'midnight-proof-server --network testnet'` |\n| Could not find a working container runtime strategy | Docker isn't running properly. Restart Docker Desktop and try again                                                     |\n| Tests fail with \"Cannot find module\"                | Compile contract first: `cd contract && npm run compact && npm run build && npm run test`                               |\n| Wallet seed validation errors                       | Enter complete 64-character hex string without extra spaces                                                             |\n| Node.js warnings about experimental features        | Normal warnings - don't affect functionality                                                                            |",
    "TESTING.md": "# Testing Procedure for Package Updates\n\nThis document outlines the steps to verify that updated package versions do not break the codebase. Follow each step and note any issues encountered.\n\n---\n\n## 1. Update the Dependencies\n\n- [ ] Run `npx npm-check-updates -u` to install the updated dependencies.\n- [ ] Follow the instructions in the [README.md](./README.md) to verify they are still correct.\n- [ ] Run the dependency installation command `npm install`\n- [ ] Confirm there are no errors\n\n## 2. Compile the Compact Contract\n\n- [ ] Compile the contract as described in the README\n- [ ] Ensure compilation completes successfully\n\n## 3. Build the Code\n\n- [ ] Build the project using the documented steps\n- [ ] Verify the build completes without errors\n\n## 4. Start the Remote Testnet\n\n- [ ] Run the following command in the `counter-cli` directory:\n  ```sh\n  npm run start-testnet-remote\n  ```\n- [ ] Confirm there are no errors (the CLI asks if you want to create a new wallet)\n\n## 5. Create a New Wallet\n\n- [ ] Create a new wallet from scratch\n- [ ] Save the wallet seed securely\n\n## 6. Fund the Wallet\n\n- [ ] Request tokens from the faucet for the new wallet\n- [ ] Confirm the transaction is successful in the CLI\n\n## 7. Wait for Wallet Update\n\n- [ ] Wait for the wallet balance to reflect the received tokens\n- [ ] Confirm the wallet shows the correct balance\n\n## 8. Deploy a New Contract\n\n- [ ] Deploy the contract to the testnet\n- [ ] Note the contract address and deployment status\n\n## 9. Increment the Contract Value\n\n- [ ] Call the increment function on the deployed contract\n- [ ] Verify the value increments as expected\n\n---\n\n## Notes\n\n- Document any errors, warnings, or unexpected behavior encountered during each step.\n- If a step fails, include troubleshooting steps and resolutions if found.\n\n---\n\n_Last updated: 30 June 2025_"
  }
}